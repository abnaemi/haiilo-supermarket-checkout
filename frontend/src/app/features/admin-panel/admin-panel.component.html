<div class="admin-sidebar">
  <h3>Admin Panel</h3>
  <mat-label>For tests</mat-label>

  @if (errorMessage()) {
    <div class="error-banner">
      <span>⚠️ {{ errorMessage() }}</span>
      <button (click)="errorMessage.set(null)" class="close-error-btn">✕</button>
    </div>
  }

  <section class="admin-section">
    <div class="section-title">
      <h4>Products</h4>
      <button class="add-icon-btn" (click)="showProductPopup.set(true)">+</button>
    </div>

    <div class="click-info-box">
      Click a product to create a Weekly Offer
    </div>

    <ul class="admin-list">
      @for (p of productState.products(); track p.id) {
        <li class="admin-item">
          <div class="item-info" (click)="selectProductForOffer(p.id)" title="Click to create offer">
            <span class="item-name">{{ p.name }}</span>
            <span class="item-sub">{{ p.price | currency:'EUR' }}</span>
            <small class="id-hint">ID: {{ p.id.substring(0,8) }}...</small>
          </div>
          <button class="del-btn" (click)="deleteProduct(p.id)">Archivieren</button>
        </li>
      }
    </ul>
  </section>

  <hr class="divider">

  <section class="admin-section">
    <div class="section-title">
      <h4>Weekly Offers</h4>
    </div>
    <ul class="admin-list">
      @for (o of offerState.offers(); track o.id) {
        <li class="admin-item">
          <div class="item-info">
            <span class="item-name">Offer for {{ o.productId.substring(0,8) }}...</span>
            <span class="item-sub">{{ o.requiredQuantity }} pcs for {{ o.offerPrice | currency:'EUR' }}</span>
          </div>
          <button class="del-btn" (click)="deleteOffer(o.id)">Archivieren</button>
        </li>
      }
    </ul>
  </section>
</div>

@if (showProductPopup()) {
  <div class="popup-overlay">
    <div class="popup-card">
      <h3>New Product</h3>
      <div class="popup-body">
        <div class="form-group">
          <label>Productname</label>
          <input [(ngModel)]="newProduct.name" type="text" placeholder="Food">
        </div>
        <div class="form-group">
          <label>Price in €</label>
          <input [(ngModel)]="newProduct.price" type="number" placeholder="Example 0.30">
        </div>
      </div>
      <div class="popup-actions">
        <button class="btn-cancel" (click)="showProductPopup.set(false)">Cancel</button>
        <button class="btn-save" (click)="saveProduct()" [disabled]="!newProduct.name">Save</button>
      </div>
    </div>
  </div>
}

@if (showOfferPopup()) {
  <div class="popup-overlay">
    <div class="popup-card">
      <h3>Create Offer</h3>
      <div class="popup-body">
        <div class="form-group">
          <label>Product ID</label>
          <input [(ngModel)]="newOffer.productId" type="text" placeholder="UUID">
        </div>
        <div class="form-group">
          <label>Required amount</label>
          <input [(ngModel)]="newOffer.requiredQuantity" type="number" placeholder="Example 3">
        </div>
        <div class="form-group">
          <label>Offerprice (€)</label>
          <input [(ngModel)]="newOffer.offerPrice" type="number" placeholder="Example 0.99">
        </div>
      </div>
      <div class="popup-actions">
        <button class="btn-cancel" (click)="showOfferPopup.set(false)">Cancel</button>
        <button class="btn-save" (click)="saveOffer()" [disabled]="!newOffer.productId">Save Offer</button>
      </div>
    </div>
  </div>
}
